import React, { useState } from "react";
import {
  AccountIcon,
  BackPrevMenu,
  BlockIcon,
  CompareIcon,
  ContactBar,
  ContactBarInfo,
  ContactBarItem,
  ContactInfoCLose,
  DropInner,
  DropMenu,
  DropMenuSub,
  ExpandBack,
  ExpandIcon,
  FlagLanguage,
  Item,
  ItemHasChildren,
  LanguageIcon,
  Main,
  MenuBar,
  MenuMobileCollapse,
  MenuMobileContent,
  MenuMobileNavbar,
  MenuMobileWrapper,
  NumberCount,
  WishlistIcon,
} from "./MenuMobile.elements";
import { Link } from "react-router-dom";

const MenuMobile = ({ itemMenus, opened }) => {
  const [active, setActive] = useState(false);
  const [showContactBar, setShowContactBar] = useState(false);
  const [idSubParent, setIdSubParent] = useState();
  const [Sub, setSub] = useState();
  const showSubMenu = (id, idParent, active) => {
    setActive(active);
    setIdSubParent(idParent);
    setSub(id);
  };

  const buildMenuHtml = (data, isSub = false) => {
    let html = [];

    data.map((item, index) => {
      if (Array.isArray(item.childrens) && item.childrens.length > 0) {
        if (!isSub) {
          html.push(
            <ItemHasChildren
              key={index}
              className={
                active === true && idSubParent === item.id ? "active" : ""
              }
            >
              <DropInner onClick={() => showSubMenu(item.id, item.id, true)}>
                <Link to="/">
                  <span>{item.name}</span>
                </Link>
                <ExpandIcon>
                  <svg width="16" height="16" viewBox="0 0 23 64">
                    <path d="M21.248 34.304q0 0.448-0.32 0.768l-16.704 16.704q-0.32 0.32-0.768 0.32t-0.832-0.32l-1.792-1.792q-0.384-0.384-0.384-0.832t0.384-0.832l14.016-14.016-14.016-14.080q-0.384-0.32-0.384-0.768t0.384-0.832l1.792-1.792q0.32-0.384 0.832-0.384t0.768 0.384l16.704 16.64q0.32 0.32 0.32 0.832z"></path>
                  </svg>
                </ExpandIcon>
              </DropInner>
              <DropMenu
                openSub={
                  active === true &&
                  (Sub === item.id || idSubParent === item.id)
                    ? 1
                    : 0
                }
                id={item.id}
              >
                <BackPrevMenu onClick={() => showSubMenu(null, null, false)}>
                  <ExpandBack>
                    <svg width="16" height="16" viewBox="0 0 23 64">
                      <path d="M22.4 19.456q0 0.448-0.384 0.768l-14.016 14.080 14.016 14.016q0.384 0.384 0.384 0.832t-0.384 0.832l-1.792 1.792q-0.32 0.32-0.768 0.32t-0.832-0.32l-16.64-16.704q-0.384-0.32-0.384-0.768t0.384-0.832l16.64-16.64q0.32-0.384 0.832-0.384t0.768 0.384l1.792 1.792q0.384 0.32 0.384 0.832z"></path>
                    </svg>
                    <span>{item.name}</span>
                  </ExpandBack>
                </BackPrevMenu>
                {buildMenuHtml(item.childrens, true)}
              </DropMenu>
            </ItemHasChildren>
          );
        } else {
          html.push(
            <div className={active === true ? "active" : ""} key={index}>
              <DropInner
                onClick={() => showSubMenu(item.id, item.parentId, true)}
                id={item.id}
                className={item.parentId}
              >
                <Link to="/">
                  <span>{item.name}</span>
                </Link>
                <ExpandIcon>
                  <svg width="16" height="16" viewBox="0 0 23 64">
                    <path d="M21.248 34.304q0 0.448-0.32 0.768l-16.704 16.704q-0.32 0.32-0.768 0.32t-0.832-0.32l-1.792-1.792q-0.384-0.384-0.384-0.832t0.384-0.832l14.016-14.016-14.016-14.080q-0.384-0.32-0.384-0.768t0.384-0.832l1.792-1.792q0.32-0.384 0.832-0.384t0.768 0.384l16.704 16.64q0.32 0.32 0.32 0.832z"></path>
                  </svg>
                </ExpandIcon>
              </DropInner>
              <DropMenuSub openSub={active === true && Sub === item.id ? 1 : 0}>
                <BackPrevMenu
                  onClick={() =>
                    showSubMenu(item.parentId, item.parentId, true)
                  }
                >
                  <ExpandBack>
                    <svg width="16" height="16" viewBox="0 0 23 64">
                      <path d="M22.4 19.456q0 0.448-0.384 0.768l-14.016 14.080 14.016 14.016q0.384 0.384 0.384 0.832t-0.384 0.832l-1.792 1.792q-0.32 0.32-0.768 0.32t-0.832-0.32l-16.64-16.704q-0.384-0.32-0.384-0.768t0.384-0.832l16.64-16.64q0.32-0.384 0.832-0.384t0.768 0.384l1.792 1.792q0.384 0.32 0.384 0.832z"></path>
                    </svg>
                    <span>{item.name}</span>
                  </ExpandBack>
                </BackPrevMenu>
                {buildMenuHtml(item.childrens)}
              </DropMenuSub>
            </div>
          );
        }
      } else {
        html.push(
          <Item key={index}>
            <Link to="/">
              <span>{item.name}</span>
            </Link>
          </Item>
        );
      }
    });
    return html;
  };
  const Menu = buildMenuHtml(itemMenus);

  return (
    <MenuMobileWrapper>
      <MenuMobileNavbar opened={opened}>
        <MenuMobileContent>
          <MenuMobileCollapse>
            <Main active={active}>
              <MenuBar>
                <BlockIcon>
                  <AccountIcon>
                    <Link to="/Account/Login">
                      <svg width="22" height="22" viewBox="0 0 59 64">
                        <path d="M28.224 0h2.496c4.544 0.256 9.088 1.984 12.48 5.056 5.568 4.928 8.256 13.056 6.336 20.288-1.216 4.864-4.416 9.024-8.384 12.032 6.4 2.944 12.16 7.744 15.040 14.272 1.728 3.712 2.56 7.744 2.88 11.776v0.576h-5.888c-0.064-5.568-2.112-11.2-5.824-15.36-4.864-5.568-12.416-8.576-19.776-7.872-7.296 0.576-14.144 4.864-18.176 11.008-2.368 3.584-3.328 7.936-3.52 12.224h-5.888v-0.64c0.384-4.032 1.216-8 2.88-11.712 2.88-6.528 8.64-11.328 15.040-14.272-6.144-4.16-9.536-11.776-8.832-19.072 0.704-9.728 9.472-17.792 19.136-18.304M26.304 6.208c-5.44 0.96-9.92 5.376-11.136 10.752-1.92 7.040 2.56 15.168 9.6 17.216 6.848 2.24 14.976-1.024 18.176-7.552 2.88-5.696 1.216-13.056-3.648-17.216-3.456-3.136-8.448-4.16-12.992-3.2z"></path>
                      </svg>
                    </Link>
                  </AccountIcon>
                  <CompareIcon>
                    <Link to="/">
                      <svg
                        width="24"
                        height="24"
                        viewBox="3.857 -48.75 22.7255 22.5"
                      >
                        <path d="M11.4258,-43.1836q2.02148,-0.117188 4.29199,-0.0146484q2.27051,0.102539 4.55566,0.0146484v2.98828q0.996094,-0.908203 2.02148,-2.05078q1.02539,-1.14258 2.13867,-2.16797q-0.996094,-1.08398 -2.00684,-2.19727q-1.01074,-1.11328 -2.03613,-2.13867q0,0.644531 0,1.47949q0,0.834961 0,1.50879q-2.37305,0.117188 -4.57031,0.0146484q-2.19727,-0.102539 -4.10156,-0.0146484q-1.78711,0 -3.2373,0.688477q-1.4502,0.688477 -2.3291,1.71387q-0.673828,0.673828 -1.23047,1.69922q-0.556641,1.02539 -0.834961,2.25586q-0.27832,1.23047 -0.219727,2.54883q0.0585938,1.34766 0.644531,2.63672q0.556641,-0.439453 1.04004,-0.981445q0.483398,-0.541992 1.06934,-1.12793q-0.292969,-1.40625 0,-2.63672q0.292969,-1.23047 0.981445,-2.15332q0.688477,-0.922852 1.68457,-1.47949q0.996094,-0.527344 2.13867,-0.585938Zm14.5312,2.51953q-0.351562,0.351562 -1.14258,1.05469q-0.791016,0.703125 -0.791016,1.05469q0,0.205078 0.0585938,0.424805q0.0585938,0.219727 0.0585938,0.454102q0,2.37305 -1.4209,4.07227q-1.4209,1.69922 -3.67676,1.78711q-0.9375,0.0585938 -2.02148,0.0585938q-1.08398,0 -2.22656,-0.0292969q-1.14258,-0.0292969 -2.31445,-0.0585938q-1.17188,0 -2.28516,0.0292969v-2.98828q-0.996094,0.996094 -2.09473,2.10938q-1.09863,1.11328 -2.12402,2.22656q0.908203,0.908203 1.88965,1.88965q0.981445,0.981445 1.86035,1.86035q0.117188,0.117188 0.249023,0.292969q0.131836,0.175781 0.219727,0.175781q0,-0.644531 0,-1.47949q0,-0.834961 0,-1.50879q2.37305,-0.117188 4.58496,-0.0146484q2.21191,0.102539 4.14551,0.0146484q1.66992,-0.117188 3.01758,-0.834961q1.34766,-0.717773 2.37305,-1.74316q0.644531,-0.615234 1.20117,-1.58203q0.556641,-0.966797 0.834961,-2.15332q0.27832,-1.18652 0.219727,-2.50488q-0.0585938,-1.31836 -0.615234,-2.60742Z"></path>
                      </svg>
                      <NumberCount>
                        <span>0</span>
                      </NumberCount>
                    </Link>
                  </CompareIcon>
                  <WishlistIcon>
                    <Link to="/">
                      <svg width="24" height="24" viewBox="0 0 26 22">
                        <path d="M23.8185 6.71922C23.8185 5.93296 23.716 5.24926 23.5109 4.66811C23.3058 4.08696 23.0408 3.61691 22.7161 3.25797C22.3913 2.89902 21.9982 2.617 21.5367 2.41189C21.0752 2.20678 20.6308 2.05294 20.2034 1.95039C19.7761 1.84783 19.3061 1.81365 18.7933 1.84783C18.2805 1.88202 17.7507 2.00166 17.2037 2.20677C16.6567 2.41189 16.1269 2.71955 15.6141 3.12978C15.1013 3.54 14.6911 3.88185 14.3834 4.15533C14.0758 4.42881 13.7852 4.71939 13.5117 5.02705C13.3408 5.24926 13.11 5.36036 12.8194 5.36036C12.5289 5.36036 12.2981 5.24926 12.1272 5.02705C11.8879 4.77066 11.5973 4.48009 11.2555 4.15533C10.9136 3.83057 10.5034 3.48872 10.0248 3.12978C9.54622 2.77083 9.01634 2.46316 8.4352 2.20677C7.85405 1.95039 7.32418 1.83074 6.84558 1.84783C6.36699 1.86492 5.89695 1.89911 5.43545 1.95039C4.97395 2.00166 4.52954 2.1555 4.10222 2.41189C3.67491 2.66828 3.28178 2.9503 2.92283 3.25797C2.56389 3.56564 2.29895 4.03568 2.12803 4.66811C1.9571 5.30054 1.85455 5.98424 1.82036 6.71922C1.82036 8.30883 2.71772 10.001 4.51245 11.7957L12.8194 19.7951L21.1264 11.7957C22.9212 10.001 23.8185 8.30883 23.8185 6.71922ZM25.6389 6.71922C25.6389 8.82161 24.545 10.9667 22.3571 13.1546L13.4604 21.7436C13.2895 21.9145 13.0758 22 12.8194 22C12.5631 22 12.3494 21.9145 12.1785 21.7436L3.25614 13.1289L2.87156 12.7444C2.70063 12.5734 2.43569 12.2572 2.07675 11.7957C1.71781 11.3342 1.39305 10.8727 1.10247 10.4112C0.811898 9.94972 0.555509 9.37712 0.333306 8.69341C0.111102 8.00971 0 7.35164 0 6.71922C0 4.61683 0.606787 2.97594 1.82036 1.79655C3.03394 0.617164 4.70901 0.018924 6.84558 0.00183139C7.42673 0.00183139 8.02497 0.104384 8.64031 0.309495C9.25564 0.514607 9.82824 0.796636 10.3581 1.15558C10.888 1.51452 11.3495 1.83928 11.7426 2.12986C12.1357 2.42043 12.4947 2.74519 12.8194 3.10414C13.1613 2.76228 13.5202 2.43752 13.8963 2.12986C14.2723 1.82219 14.7338 1.49743 15.2808 1.15558C15.8277 0.813728 16.4003 0.531699 16.9986 0.309495C17.5968 0.0872916 18.1951 -0.0152612 18.7933 0.00183139C20.9299 0.00183139 22.605 0.600071 23.8185 1.79655C25.0321 2.99303 25.6389 4.63392 25.6389 6.71922Z"></path>
                      </svg>
                      <NumberCount>
                        <span>0</span>
                      </NumberCount>
                    </Link>
                  </WishlistIcon>
                  <LanguageIcon>
                    <Link to="/">
                      <FlagLanguage></FlagLanguage>
                    </Link>
                  </LanguageIcon>
                </BlockIcon>
              </MenuBar>
              {Menu}
            </Main>
            <ContactBar>
              <ContactBarItem>
                <Link to="/">
                  <svg width="14" height="14" viewBox="0 0 64 64">
                    <path d="M57.6 52.032v0c0 0.896-0.192 1.6-0.64 2.112-0.448 0.576-0.896 1.024-1.344 1.536-1.038 1.087-2.102 2.111-3.208 3.088l-0.056 0.048c-1.063 0.938-2.26 1.768-3.548 2.448l-0.1 0.048c-1.92 0.896-4.096 1.344-6.592 1.344s-4.8-0.448-6.912-1.344c-3.864-1.425-7.171-3.538-9.927-6.215l0.007 0.007c-2.819-2.68-5.416-5.521-7.806-8.535l-0.13-0.169c-2.143-3.278-3.239-4.883-4.345-6.482l1.017 1.554c-0.928-1.346-1.925-2.956-2.847-4.613l-0.161-0.315c-0.863-1.579-1.767-3.518-2.557-5.514l-0.131-0.374c-0.793-1.952-1.339-4.213-1.531-6.574l-0.005-0.082c-0.704-4.48-0.448-8.192 0.896-11.264 1.28-3.072 3.008-5.504 5.12-7.296 0.704-0.768 1.408-1.472 1.984-2.24 0.64-0.704 1.472-1.088 2.56-1.088 1.472 0 2.752 0.768 3.84 2.368 1.088 1.536 1.856 2.752 2.368 3.648 0.576 0.896 1.28 2.112 2.112 3.648 0.726 1.36 1.152 2.974 1.152 4.688 0 0.017-0 0.034-0 0.051v-0.003c-0.256 2.368-1.28 4.032-3.2 5.056-1.856 1.024-3.136 2.432-3.904 4.224-0.192 0.768-0.192 1.536-0.064 2.368s0.32 1.664 0.64 2.368c0.192 0.896 0.512 1.856 1.088 2.752s1.152 1.856 1.6 2.88c1.152 1.664 2.368 3.264 3.648 4.8 1.268 1.528 2.722 2.84 4.343 3.922l0.073 0.046c0.576 0.448 1.344 0.96 2.368 1.664 0.96 0.704 1.984 0.96 3.072 0.704 0.96-0.192 1.728-0.576 2.304-1.216 0.512-0.64 1.024-1.344 1.536-2.048 0.704-0.448 1.344-0.96 1.856-1.536 0.512-0.64 1.088-1.024 1.792-1.216 1.6-0.448 3.136-0.128 4.544 0.832s2.56 1.92 3.456 2.816c1.152 0.96 2.304 1.984 3.456 3.072 1.152 1.024 1.856 2.368 2.176 4.032z"></path>
                  </svg>
                  <span>Call</span>
                </Link>
              </ContactBarItem>
              <ContactBarItem>
                <Link to="/">
                  <svg width="14" height="19" viewBox="0 0 64 64">
                    <path d="M59.456 53.696v-27.392q-1.152 1.28-2.496 2.304-9.536 7.36-15.232 12.096-1.792 1.536-2.944 2.368t-3.072 1.792-3.648 0.832h-0.128q-1.664 0-3.648-0.832t-3.072-1.792-2.944-2.368q-5.632-4.736-15.232-12.096-1.344-1.024-2.496-2.304v27.392q0 0.448 0.384 0.832t0.768 0.32h52.608q0.448 0 0.768-0.32t0.384-0.832zM59.456 16.192v-0.896t-0.064-0.448-0.064-0.448-0.192-0.32-0.32-0.256-0.512-0.128h-52.608q-0.448 0-0.768 0.384t-0.384 0.768q0 6.016 5.312 10.176 6.848 5.376 14.272 11.264 0.256 0.192 1.28 1.088t1.6 1.344 1.6 1.088 1.792 1.024 1.536 0.32h0.128q0.704 0 1.536-0.32t1.792-1.024 1.6-1.088 1.6-1.344 1.28-1.088q7.424-5.888 14.336-11.264 1.92-1.536 3.584-4.16t1.664-4.672zM64 14.848v38.848q0 2.368-1.664 4.032t-4.032 1.728h-52.608q-2.304 0-4.032-1.728t-1.664-4.032v-38.848q0-2.368 1.664-4.032t4.032-1.664h52.608q2.368 0 4.032 1.664t1.664 4.032z"></path>
                  </svg>
                  <span>Contact</span>
                </Link>
              </ContactBarItem>
              <ContactBarItem
                onClick={() => setShowContactBar(!showContactBar)}
              >
                <Link to="/">
                  <svg width="14" height="14" viewBox="0 0 62 64">
                    <path d="M0 30.976q0-12.864 9.088-21.888t21.888-9.088 21.952 9.088 9.088 21.888-9.088 21.952-21.952 9.088-21.888-9.088-9.088-21.952zM4.032 32q0.448 10.624 8 18.112 3.328-2.368 6.976-3.84-2.752-6.784-3.008-14.272h-11.968zM4.032 30.016h11.968q0.256-6.656 2.368-12.544-3.968-1.6-7.488-4.352-6.528 7.232-6.848 16.896zM12.224 11.648q3.264 2.496 6.912 3.968 2.752-6.464 7.488-11.264-8.384 1.408-14.4 7.296zM13.504 51.52q5.632 4.864 13.12 6.080-4.096-4.096-6.72-9.472-3.392 1.216-6.4 3.392zM17.984 32q0.256 7.104 2.88 13.632 4.416-1.408 9.152-1.664v-11.968h-12.032zM17.984 30.016h12.032v-10.048q-4.992-0.192-9.792-1.856-1.984 5.632-2.24 11.904zM20.992 16.256q4.416 1.472 9.024 1.728v-13.952h-0.128q-5.76 4.864-8.896 12.224zM21.76 47.36q3.136 6.4 8.128 10.624h0.128v-11.968q-4.416 0.256-8.256 1.344zM32 57.984h0.128q4.992-4.224 8.128-10.624-3.904-1.088-8.256-1.344v11.968zM32 43.968q4.736 0.256 9.152 1.664 2.624-6.528 2.88-13.632h-12.032v11.968zM32 30.016h12.032q-0.256-6.272-2.304-11.904-4.736 1.664-9.728 1.856v10.048zM32 17.984q4.608-0.256 9.024-1.728-3.136-7.36-8.896-12.224h-0.128v13.952zM35.392 57.6q7.488-1.216 13.12-6.080-3.008-2.176-6.4-3.392-2.624 5.376-6.72 9.472zM35.392 4.352q4.736 4.8 7.488 11.264 3.648-1.472 6.848-3.968-5.952-5.888-14.336-7.296zM43.008 46.272q3.648 1.472 6.976 3.84 7.488-7.488 8-18.112h-11.968q-0.256 7.488-3.008 14.272zM43.648 17.472q2.112 5.888 2.368 12.544h11.968q-0.384-9.664-6.848-16.896-3.52 2.752-7.488 4.352z"></path>
                  </svg>
                  <span>Store info</span>
                </Link>
              </ContactBarItem>
              <ContactBarItem>
                <Link to="/">
                  <svg width="14" height="14" viewBox="0 0 49 64">
                    <path d="M22.912 0h3.84c6.848 0.896 13.632 3.968 17.92 9.536 2.752 3.52 4.224 7.872 4.544 12.288v3.072c-0.512 5.824-2.688 11.328-5.504 16.32-4.928 8.64-11.968 15.808-18.944 22.784h-0.128c-7.424-6.464-13.44-14.4-18.752-22.656-3.136-4.928-5.44-10.56-5.888-16.448v-2.624c0.512-8.384 5.888-16.192 13.44-19.648 2.944-1.472 6.208-2.176 9.472-2.624M14.336 6.976c-4.928 2.688-8.768 7.616-9.664 13.184-0.704 4.8 0.576 9.6 2.496 13.888 4.096 9.216 10.688 16.896 17.472 24.192 0.192-0.128 0.512-0.32 0.64-0.448 6.016-6.72 11.904-13.76 16.256-21.696 2.496-4.736 3.968-10.112 3.2-15.488-0.832-6.144-5.248-11.456-10.752-14.208-6.144-3.136-13.696-2.688-19.648 0.576zM23.296 12.992c4.288-0.512 9.024 1.408 11.2 5.248 2.304 4.48 1.28 10.752-2.944 13.696-5.504 3.968-14.592 1.984-17.344-4.352-1.472-3.136-0.704-6.72 0.832-9.6 1.728-2.88 4.992-4.608 8.256-4.992M22.336 17.472c-1.92 0.64-3.648 2.112-4.224 4.16-1.152 3.776 1.984 8.256 6.016 8.192 3.776 0.384 7.808-2.688 7.36-6.72 0-4.48-5.184-7.168-9.152-5.632z"></path>
                  </svg>
                  <span>Directions</span>
                </Link>
              </ContactBarItem>
            </ContactBar>
            <ContactBarInfo showContactBar={showContactBar}>
              <ContactInfoCLose onClick={() => setShowContactBar(false)}>
                <svg width="16" height="16" viewBox="0 0 44 64">
                  <path d="M0 48.64q0-2.304 1.664-3.968l12.48-12.48-12.48-12.544q-1.664-1.6-1.664-3.904t1.664-3.904 3.904-1.6 3.904 1.6l12.544 12.544 12.48-12.544q1.6-1.6 3.904-1.6t3.904 1.6 1.6 3.904-1.6 3.904l-12.48 12.544 12.48 12.48q1.6 1.664 1.6 3.968t-1.6 3.904-3.904 1.6-3.904-1.6l-12.48-12.48-12.544 12.48q-1.6 1.6-3.904 1.6t-3.904-1.6q-1.664-1.664-1.664-3.904z"></path>
                </svg>
              </ContactInfoCLose>
              <p>
                683 Tran Hung Dao Street
                <br />
                Ho Chi Minh city
              </p>
              <p>
                Mon-Sat, 11-7
                <br />
                Sun, 12-5
              </p>
            </ContactBarInfo>
          </MenuMobileCollapse>
        </MenuMobileContent>
      </MenuMobileNavbar>
    </MenuMobileWrapper>
  );
};

export default MenuMobile;
